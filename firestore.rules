rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // ── User data ─────────────────────────────────────────
    // Each signed-in user can only read/write their own document.
    match /users/{uid} {
      allow read, write: if request.auth != null && request.auth.uid == uid;
    }

    // ── Invite codes ──────────────────────────────────────
    // Any signed-in user can read (to join), create (to share), or delete.
    // Deletion is allowed by any auth user because only the owner knows the
    // invite code and is the one calling stopSharing().
    match /inviteCodes/{code} {
      allow read, write: if request.auth != null;
    }

    // ── Shared babies ─────────────────────────────────────
    // Any signed-in user can read/write.
    // The shareId is a UUID (never shown publicly) and the invite code
    // gates discovery — authenticated access is sufficient for this app.
    match /sharedBabies/{shareId} {
      allow read, write: if request.auth != null;

      match /events/{evId} {
        allow read, write: if request.auth != null;
      }
    }

  }
}
